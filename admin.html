<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Área do Gestor — IPEV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --azul: #0ea5b7;
      --branco:#fff;
      --texto:#0b2340;
    }
    html,body{
      margin:0; padding:0; font-family: Arial, Helvetica, sans-serif;
      background:#f3f7f8; color:var(--texto);
    }

    /* HERO com a sua imagem (mesma pasta) */
    .hero{
      position: relative;
      min-height: 280px;                  /* mais alto pra respirar */
      display:flex; align-items:flex-end; /* título sempre “apoiado” na base */
      background-image:
        linear-gradient(rgba(0,0,0,.35), rgba(0,0,0,.35)),
        url('frota-bg.jpg');
      background-size: cover;
      background-position: center;
      box-shadow: inset 0 -30px 30px rgba(0,0,0,.18); /* leve sombra na base */
    }
    .hero .wrap{
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 20px 36px;
      display:flex; justify-content: space-between; align-items: flex-end;
      gap: 16px;
    }
    .titulo{
      color: var(--branco);
      margin: 0 0 6px 0;
      font-size: 34px;
      letter-spacing: .5px;
      line-height: 1.15;
      text-shadow: 0 2px 6px rgba(0,0,0,.35);
    }
    .sub{
      color:#eaf7fb;
      margin:0;
      font-size:15px;
      line-height: 1.3;
    }
    .chip-user{
      background: rgba(255,255,255,.95);
      color:#123;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 13px;
      box-shadow: 0 2px 10px rgba(0,0,0,.20);
      white-space: nowrap;
    }

    /* CONTEÚDO */
    .main{
      max-width:1100px;
      margin: 26px auto 34px;   /* sem margem negativa: nada sobreposto */
      padding: 0 20px;
    }
    .card{
      background:#fff;
      border-radius:14px;
      box-shadow: 0 10px 24px rgba(16,24,40,.08);
      padding: 22px;
    }
    .card h2{
      margin: 0 0 16px 2px;
      color:#124a63;
      font-size:22px;
      letter-spacing:.2px;
    }
    .grid-actions{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    .btn{
      appearance:none; border:0; cursor:pointer;
      padding:16px 18px; border-radius:12px; font-size:16px; font-weight:bold;
      color:#fff; background: linear-gradient(135deg, var(--azul), #1d9bb7);
      box-shadow: 0 8px 18px rgba(13, 135, 160, .25);
      transition: transform .05s ease, box-shadow .2s ease, opacity .2s ease;
      text-align:center;
      width:100%;
      max-width: 760px;             /* centralizado e largo, mas com limite */
      margin-inline: auto;
    }
    .btn:hover{ box-shadow: 0 10px 22px rgba(13, 135, 160, .32); }
    .btn:active{ transform: translateY(1px); }
    .muted{ color:#516271; font-size:13px; margin-top:10px; margin-left:2px; }

    /* Topo com Sair */
    .topbar {
      position: fixed; top: 10px; right: 10px; z-index: 20;
      display:flex; gap:8px; align-items:center;
    }
    .btn-sair { background:#6b7280; color:#fff; border:0; border-radius:6px; padding:8px 14px; cursor:pointer; }
    .btn-sair:hover { background:#4b5563; }

    @media (max-width: 640px){
      .titulo{ font-size:28px; }
      .chip-user{ font-size:12px; padding:8px 12px; }
    }
  </style>
</head>
<body>

  <!-- TOPBAR: botão Sair -->
  <div class="topbar">
    <button id="btnSair" class="btn-sair">Sair</button>
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="wrap">
      <div>
        <h1 class="titulo">Área do Gestor</h1>
        <p class="sub">Gestão de usuários, permissões do sistema e atualização de dados</p>
      </div>
      <div id="chipUser" class="chip-user"></div>
    </div>
  </section>

  <!-- CONTEÚDO -->
  <main class="main">
    <div class="card">
      <h2>Ações rápidas</h2>
      <div class="grid-actions">
        <button id="btnCadastrar" class="btn">+ Cadastrar usuário</button>
      </div>
      <div class="muted">Em breve: listar usuários, redefinir senha, permissões, etc.</div>
    </div>
  </main>

  <!-- Proteção + lógica -->
  <script type="module">
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js'

    const supabase = createClient(
      'https://ilsbyrvnrkutwynujfhs.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlsc2J5cnZucmt1dHd5bnVqZmhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNDAwNDEsImV4cCI6MjA2OTkxNjA0MX0.o56R-bf1Nt3PiqMZbG_ghEPYZzrPnEU-jCdYKkjylTQ'
    )

    const ADMIN_EMAIL = 'contato.ipev@gmail.com'

    // Exige sessão
    const { data: { session } } = await supabase.auth.getSession()
    if (!session) {
      window.location.replace('index.html')
    }

    // Confirma que é admin
    const { data: { user } } = await supabase.auth.getUser()
    const email = (user?.email || '').toLowerCase()
    if (email !== ADMIN_EMAIL) {
      window.location.replace('menu.html')
    }

    // Buscar nome do usuário em usuarios_app (display_name → username → fallback e-mail)
    let nome = email.split('@')[0]
    try {
      const { data: perfil, error } = await supabase
        .from('usuarios_app')
        .select('display_name, username')
        .eq('id', user.id)
        .maybeSingle()
      if (!error && perfil) {
        nome = perfil.display_name || perfil.username || nome
      }
    } catch(_) { /* ignora, usa fallback */ }

    // Exibe quem está logado (nome)
    document.getElementById('chipUser').textContent = `Logado: ${nome}`

    // Botão cadastrar (placeholder)
    document.getElementById('btnCadastrar').addEventListener('click', () => {
      alert('Tela de cadastro de usuário (em breve).')
    })

    // Botão sair
    document.getElementById('btnSair')?.addEventListener('click', async () => {
      await supabase.auth.signOut()
      window.location.replace('index.html')
    })

    // Se deslogar em outra aba, sair aqui também
    supabase.auth.onAuthStateChange((event) => {
      if (event === 'SIGNED_OUT') window.location.replace('index.html')
    })
  </script>
</body>
</html>
