<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controle de Logística IPEV</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-white text-gray-900 font-sans">
  <div class="p-4">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-blue-800">Controle de Logística IPEV</h1>
      <a href="menu.html" class="text-blue-600 hover:underline">Voltar ao menu</a>
    </div>

    <form id="controleForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <input type="date" id="data" class="border p-2 rounded" required>
        <input type="text" id="motorista" placeholder="Motorista" class="border p-2 rounded" required>
        <input type="text" id="placa" placeholder="Placa do carro" class="border p-2 rounded" required>
        <input type="text" id="rota" placeholder="Rota (ex: A, B, C...)" class="border p-2 rounded" required>
        <input type="number" step="0.1" id="kmRota1" placeholder="KM Rota 1" class="border p-2 rounded">
        <input type="number" step="0.1" id="kmRota2" placeholder="KM Rota 2" class="border p-2 rounded">
        <input type="number" step="0.1" id="kmAdicional" placeholder="KM Adicional" class="border p-2 rounded">
        <input type="number" step="0.01" id="valorGasolina" placeholder="Valor da gasolina (R$)" class="border p-2 rounded">
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Salvar</button>
    </form>

    <div id="mensagem" class="mt-4 text-green-600 font-semibold"></div>
  </div>

  <script>
    const supabaseUrl = 'https://ilsbyrvnrkutwynujfhs.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlsc2J5cnZucmt1dHd5bnVqZmhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTIzMTUzMzcsImV4cCI6MjAyNzg5MTMzN30.vILfpzuPVqaLqRJUszfpTPctDXUxrkyUZzwUcr_3EOI';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    document.getElementById('controleForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = document.getElementById('data').value;
      const motorista = document.getElementById('motorista').value;
      const placa = document.getElementById('placa').value;
      const rota = document.getElementById('rota').value;
      const kmRota1 = parseFloat(document.getElementById('kmRota1').value) || 0;
      const kmRota2 = parseFloat(document.getElementById('kmRota2').value) || 0;
      const kmAdicional = parseFloat(document.getElementById('kmAdicional').value) || 0;
      const valorGasolina = parseFloat(document.getElementById('valorGasolina').value) || 0;

      const { error } = await supabase.from('controle_diario').insert([{
        data,
        motorista,
        placa,
        rota,
        km_rota_1: kmRota1,
        km_rota_2: kmRota2,
        km_adicional: kmAdicional,
        valor_gasolina: valorGasolina
      }]);

      const mensagemDiv = document.getElementById('mensagem');

      if (error) {
        mensagemDiv.textContent = `Erro ao salvar: ${error.message}`;
        mensagemDiv.classList.remove('text-green-600');
        mensagemDiv.classList.add('text-red-600');
      } else {
        mensagemDiv.textContent = 'Dados salvos com sucesso!';

        // Limpa os campos, exceto KM Adicional e Valor Gasolina
        document.getElementById('data').value = '';
        document.getElementById('motorista').value = '';
        document.getElementById('placa').value = '';
        document.getElementById('rota').value = '';
        document.getElementById('kmRota1').value = '';
        document.getElementById('kmRota2').value = '';
        // KM Adicional e Valor Gasolina permanecem
      }
    });
  </script>
</body>
</html>
